---
title: "Supreme Court"
author: "Bertrand Wilden"
date: "2024-05-29"
categories: [Bayes]
max-description-length: 20
draft: true
execute: 
  message: false
  warning: false
---

```{r}
library(dplyr)
library(brms)
library(tidybayes)
library(ggplot2)
library(ggdist)
```


```{r}
votes <- readr::read_csv(here::here("posts", "sc-ideal", "data-raw", "SCDB_2023_01_justiceCentered_Vote.csv"))
```

```{r}
votes_recent <- votes |> 
  filter(term == 2022) |> 
  mutate(direction = case_when(direction == 2 ~ 1,
                               direction == 1 ~ 2,
                               .default = NA))
```

```{r}
irt_formula <- bf(
  direction ~ gamma * theta + beta,
  gamma ~ (1 | caseId),
  theta ~ (1 | justiceName),
  beta ~ (1 | caseId),
  nl = TRUE
)

irt_priors <- 
  prior(normal(0, 2), class = b, nlpar = gamma, lb = 0) +
  prior(normal(0, 2), class = b, nlpar = theta) +
  prior(normal(0, 2), class = b, nlpar = beta)
```


```{r}
#| eval: false
get_prior(irt_formula, 
          data = votes_recent, 
          family = bernoulli(link = "probit"))
```


```{r}
irt_fit <- brm(
  formula = irt_formula,
  prior = irt_priors,
  data = votes_recent,
  family = bernoulli(link = "probit"),
  backend = "cmdstanr",
  cores = 8,
  threads = threading(2),
  control = list(adapt_delta = 0.99,
                 max_treedepth = 15),
  refresh = 0,
  seed = 111
)
```


```{r}
summary(irt_fit)
```


```{r}
#| eval: false
get_variables(irt_fit)
```


```{r}
justice_draw <- irt_fit |> 
  spread_draws(r_justiceName__theta[justice,]) |> 
  ungroup() |> 
  mutate(justice = case_when(justice == "SAAlito" ~ "Alito",
                             justice == "CThomas" ~ "Thomas",
                             justice == "NMGorsuch" ~ "Gorsuch",
                             justice == "ACBarrett" ~ "Barrett",
                             justice == "JGRoberts" ~ "Roberts",
                             justice == "BMKavanaugh" ~ "Kavanaugh",
                             justice == "KBJackson" ~ "Jackson",
                             justice == "EKagan" ~ "Kagan",
                             justice == "SSotomayor" ~ "Sotomayor"),
         theta = r_justiceName__theta,
         justice = forcats::fct_reorder(justice, theta))
```


```{r}
justice_draw |> 
  ggplot(aes(x = theta, 
             y = justice)) +
  stat_slabinterval(aes(fill_ramp = after_stat(x)),
                    fill = "green",
                    density = "unbounded",
                    alpha = .75) +
  scale_fill_ramp_continuous(from = "blue") +
  xlim(c(-3.5, 3.5)) +
  labs(x = "Ideology", y = "", title = "2022 Term") +
  theme_minimal()

# ggsave("judge_ideolog.png", bg = "white")
```


